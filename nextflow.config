
// reference
params.ref_dir = '/home/users/astar/acrc/aicloudtestuser3/scratch/reference/GRCh38/jaffa_hg38/'
params.transFasta = '${arams.ref_dir}/hg38_genCode22.fa'     // adjust to your transcriptome fasta
params.refGenome = '${arams.ref_dir}/hg38.fa'                // adjust to your genome fasta
params.refGeneTab = '${arams.ref_dir}/hg38_genCode22.tab'    // used by process_transcriptome_align_table and R

// Nextflow configuration with Singularity/Apptainer enabled
singularity {
  enabled = true
  autoMounts = true
}

process {
  executor = 'slurm' //'local'
  clusterOptions = { ' -V --partition=testqueue --gres=gpu:1  -A aicloud-testgroup ' }  // Remove account specification or update with your actual account
  penv = 'OpenMP'
  // errorStrategy = { task.attempt < 2 ? 'retry' : 'finish' }
  pollInterval = '30 sec'
  exitReadTimeout = "120 sec"

  cpus = 1
  memory = { check_max( 10.GB * task.attempt, 'memory' ) }
  time = { check_max( 2.h * task.attempt, 'time' ) }

  errorStrategy = { task.exitStatus in [140,143,137,104,134,139] ? 'retry' : 'finish' }
  maxRetries = 3
  maxErrors = '-1'
 
}

// Default container images - replace these placeholders with images available to you.
params.container = [
  bbmap: 'docker://quay.io/biocontainers/bbmap:latest',
  minimap2: 'docker://quay.io/biocontainers/minimap2:latest',
  r_base: 'docker://rocker/r-base:4.2.2',
  base: 'docker://ubuntu:20.04'
]

// Per-process CPU/memory defaults (can be overridden in command line or params file)
params.cpus = [
  get_fasta: 8,
  minimap2_transcriptome: 16,
  minimap2_genome: 16,
  filter_transcripts: 1,
  extract_fusion_sequences: 1,
  get_final_list: 2
]

params.memory = [
  get_fasta: '8 G',
  minimap2_transcriptome: '48 G',
  minimap2_genome: '64 G',
  filter_transcripts: '4 G',
  extract_fusion_sequences: '4 G',
  get_final_list: '4 G'
] 

// Helpful tips when running on Windows with Apptainer: provide absolute path to .sif images
// or use Docker images which Nextflow will convert when Singularity/Apptainer is available.
